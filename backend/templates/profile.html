{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='profile.css') }}">

<div class="profile-container">

    <!-- Top Profile Card -->
    <div class="profile-header">
        <div class="avatar">
            {{ user.username[0].upper() }}
        </div>
        <div>
            <h3>{{ user.username }}</h3>
            <p>{{ user.email }}</p>
        </div>
        <button class="edit-btn" onclick="toggleEdit()">Edit</button>
    </div>

    <!-- Tabs -->
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'overview')">Overview</button>
        <button class="tab-btn" onclick="openTab(event, 'health')">Health & Safety</button>
    </div>

    <form method="POST" action="{{ url_for('auth.update_profile') }}">

        <!-- OVERVIEW TAB -->
        <div id="overview" class="tab-content active">
            <div class="grid">

                <div class="card">
                    <h4>Contact Info</h4>
                    <input class="editable" type="tel" name="phone" placeholder="Phone" value="{{ user.phone }}" disabled>
                    <input class="editable" name="address" placeholder="Address" value="{{ user.address }}" disabled>
                </div>

                <div class="card">
                    <h4>Emergency Contact</h4>
                    <input class="editable" name="emergency_name" placeholder="Name" value="{{ user.emergency_name }}" disabled>
                    <input class="editable" name="emergency_relation" placeholder="Relation" value="{{ user.emergency_relation }}" disabled>
                    <input class="editable" type="tel" name="emergency_phone" placeholder="Phone" value="{{ user.emergency_phone }}" disabled>
                </div>

                <div class="card">
                    <h4>Demographics</h4>
                    <input class="editable" type="date" name="dob" value="{{ user.dob }}" disabled>
                    <select class="editable" name="gender" disabled>
                        <option value="Male" {% if user.gender=='Male' %}selected{% endif %}>Male</option>
                        <option value="Female" {% if user.gender=='Female' %}selected{% endif %}>Female</option>
                        <option value="Other" {% if user.gender=='Other' %}selected{% endif %}>Other</option>
                    </select>
                </div>

            </div>
        </div>

        <!-- HEALTH TAB -->
        <div id="health" class="tab-content">
            <div class="grid">

                <div class="card">
                    <h4>Physical Metrics</h4>
                    <input class="editable" id="height" type="number" name="height" placeholder="Height (cm)" value="{{ user.height }}" disabled oninput="calculateBMI()">
                    <input class="editable" id="weight" type="number" name="weight" placeholder="Weight (kg)" value="{{ user.weight }}" disabled oninput="calculateBMI()">
                    <input id="bmi" readonly placeholder="BMI" value="{{ user.bmi }}">
                </div>

                <div class="card">
                    <h4>Medical Safety</h4>
                    <input class="editable" name="allergies" placeholder="Allergies" value="{{ user.allergies }}" disabled>
                    <textarea class="editable" name="medical_notes" placeholder="Medical Notes" disabled>{{ user.medical_notes }}</textarea>
                </div>

            </div>
        </div>

        <div class="actions">
            <button type="submit" class="save-btn editable" disabled>Save Changes</button>
            <a href="{{ url_for('auth.logout') }}" class="logout-btn">Logout</a>
        </div>

    </form>
</div>

<script>
function toggleEdit() {
    const editables = document.querySelectorAll('.editable');
    editables.forEach(el => el.disabled = !el.disabled);
    document.querySelector('.save-btn').disabled = !document.querySelector('.save-btn').disabled;
}

function openTab(event, tabId) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    event.currentTarget.classList.add('active');
}

function calculateBMI() {
    let h = document.getElementById("height").value / 100;
    let w = document.getElementById("weight").value;
    if (h > 0 && w > 0) {
        document.getElementById("bmi").value = (w / (h * h)).toFixed(2);
    }
}
</script>

{% endblock %}



